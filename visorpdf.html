<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Presentación PDF con Transición Suave</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #f0f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    canvas {
      opacity: 0;
      /* Solo transición de opacidad, el transform se maneja en el JS */
      transition: opacity 0.5s ease-in-out;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    .nav-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: #6C7A89;
      border: none;
      padding: 15px;
      font-size: 24px;
      color: #ffffff;
      cursor: pointer;
      z-index: 10;
      border-radius: 10px;
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    .nav-button:hover {
      background-color: #5A6673;
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .nav-button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background-color: #6C7A89;
        box-shadow: none;
    }
    #prev-button {
      left: 10px;
    }
    #next-button {
      right: 10px;
    }
    
    #main-controls-container {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      max-width: 500px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 8px 12px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    #left-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    #center-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-grow: 1;
    }
    
    #right-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    #progress-container {
      flex-grow: 1;
      height: 12px;
      background-color: #e9ecef;
      border-radius: 6px;
      overflow: hidden;
    }
    #progress-bar {
      position: relative;
      height: 100%;
      width: 0%;
      background-color: #28a745;
      transition: width 0.3s ease-in-out;
      overflow: hidden;
    }
    #progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 250%;
      height: 100%;
      background: repeating-linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.2),
        rgba(255, 255, 255, 0.2) 10px,
        transparent 10px,
        transparent 20px
      );
      animation: progress-animation 2s linear infinite;
    }
    @keyframes progress-animation {
      from { transform: translateX(0); }
      to { transform: translateX(-100px); }
    }
    
    #timer {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background-color: #fff;
      border-radius: 20px;
      border: 1px solid #28a745;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      font-family: sans-serif;
      font-size: 16px;
      color: #343a40;
    }
    #timer .icon {
      margin-right: 8px;
    }
    
    .control-button {
      background-color: #6C7A89;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .control-button:hover {
      background-color: #5A6673;
    }
    .control-button.active {
        background-color: #28a745;
        color: #fff;
    }

    #trophy-icon {
      width: 45px;
      height: 45px;
      display: none;
      animation: medal-bounce 0.8s infinite alternate;
    }
    @keyframes medal-bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-8px); }
    }
    #error-message {
      color: red;
      font-family: sans-serif;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <button id="prev-button" class="nav-button">&lt;</button>
  <canvas id="pdf-canvas"></canvas>
  <button id="next-button" class="nav-button">&gt;</button>
  
  <div id="main-controls-container">
    <div id="left-controls">
      <button class="control-button" id="reset-zoom-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          <line x1="8" y1="11" x2="14" y2="11"></line>
        </svg>
      </button>
      <button class="control-button" id="zoom-in-btn">+</button>
      <button class="control-button" id="zoom-out-btn">-</button>
      <button class="control-button" id="hand-btn">✋</button>
    </div>

    <div id="center-controls">
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
    </div>

    <div id="right-controls">
      <div id="trophy-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-award">
          <circle cx="12" cy="8" r="7"></circle>
          <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline>
        </svg>
      </div>
      <div id="timer"><span class="icon">⏰</span><span id="timer-text">00:00</span></div>
    </div>
  </div>

  <div id="error-message"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const pdfUrl = params.get('pdf');

    if (!pdfUrl) {
        document.getElementById("error-message").textContent = "Error: No se encontró la dirección del PDF en la URL. Por favor, agregue ?pdf=URL_DEL_PDF";
    } else {
        let pdfDoc = null;
        let pageNum = 1;
        let scale = 0.95;
        let isHandMode = false;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let transformX = 0;
        let transformY = 0;

        const canvas = document.getElementById("pdf-canvas");
        const ctx = canvas.getContext("2d");
        const prevButton = document.getElementById("prev-button");
        const nextButton = document.getElementById("next-button");
        const progressBar = document.getElementById("progress-bar");
        const timerText = document.getElementById("timer-text");
        const trophyIcon = document.getElementById("trophy-icon"); 
        const resetZoomBtn = document.getElementById("reset-zoom-btn");
        const zoomInBtn = document.getElementById("zoom-in-btn");
        const zoomOutBtn = document.getElementById("zoom-out-btn");
        const handBtn = document.getElementById("hand-btn");
        let startTime = Date.now();
        
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

        pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
            pdfDoc = pdf;
            renderPage(pageNum);
            updateButtons();
            setInterval(updateTimer, 1000);
        }).catch(error => {
            document.getElementById("error-message").textContent = "Error al cargar el PDF: " + error.message;
            console.error("Error al cargar el PDF:", error);
        });

        function renderPage(num) {
            // El canvas se vuelve transparente antes de cargar la siguiente página
            canvas.style.opacity = 0;

            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale: scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };

                page.render(renderContext).promise.then(() => {
                    // El canvas se vuelve visible suavemente después de que la página se ha cargado
                    canvas.style.opacity = 1;
                    canvas.style.transform = `translate(${transformX}px, ${transformY}px)`;
                });
            });
            updateButtons();
            updateProgressBar();
        }

        function zoomIn() {
            scale = Math.min(scale + 0.2, 3.0);
            renderPage(pageNum);
        }

        function zoomOut() {
            scale = Math.max(scale - 0.2, 0.4);
            renderPage(pageNum);
        }

        function resetZoom() {
            scale = 0.95;
            transformX = 0;
            transformY = 0;
            renderPage(pageNum);
        }

        function toggleHand() {
            isHandMode = !isHandMode;
            if (isHandMode) {
                canvas.style.cursor = 'grab';
                handBtn.classList.add('active');
            } else {
                canvas.style.cursor = 'default';
                handBtn.classList.remove('active');
            }
        }

        canvas.addEventListener('mousedown', (e) => {
            if (isHandMode) {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                transformX += dx;
                transformY += dy;
                canvas.style.transform = `translate(${transformX}px, ${transformY}px)`;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            if (isHandMode) {
                canvas.style.cursor = 'grab';
            }
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            if (isHandMode) {
                canvas.style.cursor = 'grab';
            }
        });

        function prevPage() {
            if (pageNum > 1) {
                pageNum--;
                renderPage(pageNum);
            }
        }

        function nextPage() {
            if (pageNum < pdfDoc.numPages) {
                pageNum++;
                renderPage(pageNum);
            }
        }

        function updateButtons() {
            prevButton.disabled = (pageNum <= 1);
            nextButton.disabled = (pageNum >= pdfDoc.numPages);

            if (pdfDoc && pageNum === pdfDoc.numPages) {
                trophyIcon.style.display = 'block';
            } else {
                trophyIcon.style.display = 'none';
            }
        }

        function updateProgressBar() {
            const progress = (pageNum / pdfDoc.numPages) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        function updateTimer() {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            timerText.textContent = formattedTime;
        }

        prevButton.addEventListener("click", prevPage);
        nextButton.addEventListener("click", nextPage);
        zoomInBtn.addEventListener("click", zoomIn);
        zoomOutBtn.addEventListener("click", zoomOut);
        handBtn.addEventListener("click", toggleHand);
        resetZoomBtn.addEventListener("click", resetZoom);
    }
  </script>
</body>
</html>